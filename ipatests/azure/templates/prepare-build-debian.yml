steps:
- script: |
    set -e
    sudo apt-get update -y
    sudo apt-get dist-upgrade -y
    echo "Installing base development environment"
    sudo \
        DEBIAN_FRONTEND=noninteractive \
        apt-get install -y \
        software-properties-common \
        dpkg-dev \
        docker.io \
        python3-all-dev \
        python3-cffi \
        python3-m2r \
        python3-paramiko \
        python3-sphinx \
        python3-yaml \
        rpmlint \

    sudo apt-add-repository -y ppa:freeipa/staging

    rm -fr debian/patches

    echo "Installing FreeIPA development dependencies"
    sudo dpkg-checkbuilddeps 2>&1 \
        | sed 's/.*dependencies: //;s/([^)]*)//g' \
        | xargs sudo DEBIAN_FRONTEND=noninteractive apt-get install -y
  displayName: Prepare build environment
